<div class="row">
    <div class="col-md-1"></div>
    <div id="cardDetails" class="col-md-10">
        <div class="card" id="pay">
            <div class="card-header ">
                <div class="row">
                    <div class="col-md-4">
                        Select Your Seats Here...
                    </div>
                    <div class="col-md-1"></div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="availableSt"></div>
                                <span><b>Available Seats</span></b>
                            </div>
                            <div class="col-md-3">
                                <div class="processingSt"></div>
                                <span><b>Processing Seats</span></b>
                            </div>
                            <div class="col-md-3">
                                <div class="counterSt"></div>
                                <span><b>Counter Seats</span></b>
                            </div>
                            <div class="col-md-3">
                                <div class="bookedSt"></div>
                                <span><b>Booked Seats</span></b>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-11">
                        <div>
                            <div class="row mt-2">
                                <div class="seatD available">
                                    <h6>D</h6>
                                </div>
                                <div class="seat available" id="4" style="background-color: #ffc266 ;pointer-events: none">
                                    <h6>04</h6>
                                </div>
                                <div class="seat available" id="8">
                                    <h6>08</h6>
                                </div>
                                <div class="seat available" id="12">
                                    <h6>12</h6>
                                </div>
                                <div class="seat available" id="16">
                                    <h6>16</h6>
                                </div>
                                <div class="seat available" id="20">
                                    <h6>20</h6>
                                </div>
                                <div class="seat available" id="24">
                                    <h6>24</h6>
                                </div>
                                <div class="seat available" id="28">
                                    <h6>28</h6>
                                </div>
                                <div class="seat available" id="32">
                                    <h6>32</h6>
                                </div>
                                <div class="seat available" id="36">
                                    <h6>36</h6>
                                </div>
                                <div class="seat available" id="40">
                                    <h6>40</h6>
                                </div>
                                <div class="seat available" id="44">
                                    <h6>44</h6>
                                </div>
                                <div class="seatN available"></div>
                                <div class="seat available" id="50">
                                    <h6>50</h6>
                                </div>
                            </div>

                            <div class="row mt-2">
                                <div class="seatN available"></div>
                                <div class="seat available" id="3" style="background-color: #ffc266 ;pointer-events: none">
                                    <h6>03</h6>
                                </div>
                                <div class="seat available" id="7">
                                    <h6>07</h6>
                                </div>
                                <div class="seat available" id="11">
                                    <h6>11</h6>
                                </div>
                                <div class="seat available" id="15">
                                    <h6>15</h6>
                                </div>
                                <div class="seat available" id="19">
                                    <h6>19</h6>
                                </div>
                                <div class="seat available" id="23">
                                    <h6>23</h6>
                                </div>
                                <div class="seat available" id="27">
                                    <h6>27</h6>
                                </div>
                                <div class="seat available" id="31">
                                    <h6>31</h6>
                                </div>
                                <div class="seat available" id="35">
                                    <h6>35</h6>
                                </div>
                                <div class="seat available" id="39">
                                    <h6>39</h6>
                                </div>
                                <div class="seat available" id="43">
                                    <h6>43</h6>
                                </div>
                                <div class="seatN available"></div>
                                <div class="seat available" id="49">
                                    <h6>49</h6>
                                </div>
                            </div>

                            <div class="row mt-2">
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seat available" id="48">
                                    <h6>48</h6>
                                </div>
                            </div>


                            <div class="row mt-2">
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seatN available"></div>
                                <div class="seat available" id="47">
                                    <h6>47</h6>
                                </div>
                            </div>

                            <div class="row mt-2">
                                <div class="seatN available"></div>
                                <div class="seat available" id="2" style="background-color: #ffc266 ;pointer-events: none">
                                    <h6>02</h6>
                                </div>
                                <div class="seat available" id="6">
                                    <h6>06</h6>
                                </div>
                                <div class="seat available" id="10">
                                    <h6>10</h6>
                                </div>
                                <div class="seat available" id="14">
                                    <h6>14</h6>
                                </div>
                                <div class="seat available" id="18">
                                    <h6>18</h6>
                                </div>
                                <div class="seat available" id="22">
                                    <h6>22</h6>
                                </div>
                                <div class="seat available" id="26">
                                    <h6>26</h6>
                                </div>
                                <div class="seat available" id="30">
                                    <h6>30</h6>
                                </div>
                                <div class="seat available" id="34">
                                    <h6>34</h6>
                                </div>
                                <div class="seat available" id="38">
                                    <h6>38</h6>
                                </div>
                                <div class="seat available" id="42">
                                    <h6>42</h6>
                                </div>
                                <div class="seatN available"></div>
                                <div class="seat available" id="46">
                                    <h6>46</h6>
                                </div>
                            </div>

                            <div class="row mt-2">
                                <div class="seatN available"></div>
                                <div class="seat available" id="1" style="background-color: #ffc266 ;pointer-events: none">
                                    <h6>01</h6>
                                </div>
                                <div class="seat available" id="5" style="background-color: #ffc266 ;pointer-events: none">
                                    <h6>05</h6>
                                </div>
                                <div class="seat available" id="9">
                                    <h6>09</h6>
                                </div>
                                <div class="seat available" id="13">
                                    <h6>13</h6>
                                </div>
                                <div class="seat available" id="17">
                                    <h6>17</h6>
                                </div>
                                <div class="seat available" id="21">
                                    <h6>21</h6>
                                </div>
                                <div class="seat available" id="25">
                                    <h6>25</h6>
                                </div>
                                <div class="seat available" id="29">
                                    <h6>29</h6>
                                </div>
                                <div class="seat available" id="33">
                                    <h6>33</h6>
                                </div>
                                <div class="seat available" id="37">
                                    <h6>37</h6>
                                </div>
                                <div class="seat available" id="41">
                                    <h6>41</h6>
                                </div>
                                <div class="seatN available"></div>
                                <div class="seat available" id="45">
                                    <h6>45</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer mt-3">
                        <div class="row">
                            <div class="col-md-10"></div>
                            <div class="col-md-2">
                                <button type="button" class="btn btn-outline-success proceed" id="proceed">Proceed</button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class=" col-md-1 alert alert-danger" style="height:140px" role="alert" id="errM">
        <span id="bus">Plese select your seat! </span>
    </div>
</div>


<script>
    var selectedIds = [];
    $("#errM").hide();

    $(document).on("click", ".seat", function() {
        var id = $(this).attr("id");
        var index = selectedIds.indexOf(id); // Check if the seat is already selected

        if (index !== -1) {
            selectedIds.splice(index, 1); // Remove the seat from the selectedIds array
            $(this).css('background-color', ''); // Remove the background color
        } else {
            selectedIds.push(id);

            if (selectedIds.length < 6) {
                $(this).css('background-color', '#007FFF');
            } else {
                alert("You can't select more than 5 seats");
            }
        }
    });


    $(document).on("click", ".proceed", function() {
        for (var i = 0; i <= selectedIds.length; i++) {
            console.log(selectedIds[i]);
        }
        // alert($date);
        // alert($trpId);
        $noOfSeats = selectedIds.length;
        // alert($noOfSeats);
        if ($noOfSeats < 1) {
            $("#errM").show();
            setTimeout(function() {
                $("#errM").hide();
            }, 3000);
        } else {
            $.ajax({
                url: '../routes/user/seatPlan.php',
                type: 'POST',
                data: {
                    seatArray: JSON.stringify(selectedIds),
                    trpId: $trpId,
                    resDate: $date
                },
                success: function(response) {
                    console.log(response);
                    var url = 'user/reservation.php';
                    $("#uRoot").load(url);
                },
                error: function(xhr, status, error) {
                    console.log(xhr.responseText);
                }
            });
        }


    });


    $.ajax({
        url: '../routes/user/getSeats.php',
        type: 'POST',
        data: {
            trpId: $trpId,
            resDate: $date
        },
        success: function(data) {
            // console.log(data);
            var dataArray = data.split(','); // split the response into an array
            for (var i = 0; i < dataArray.length; i++) { // modified loop condition
                var id = dataArray[i];
                if (id) { // check if the id is not empty or undefined
                    id = id.trim(); // trim the id
                    $('#' + id).css('background-color', '#8080FF');
                    $('#' + id).css('pointer-events', 'none');
                }
            }
            // console.log(dataArray); // log the array to the console
        }
    });


    // get reserved(payed) seats
    $.ajax({
        url: '../routes/user/getSeatsReserved.php',
        type: 'POST',
        data: {
            trpId: $trpId,
            resDate: $date
        },
        success: function(data) {
            var dataArray = data.split(',');
            for (var i = 0; i < dataArray.length; i++) {
                var id = dataArray[i];
                if (id) {
                    id = id.trim();
                    $('#' + id).css('background-color', '#b30000');
                    $('#' + id).css('pointer-events', 'none');
                }
            }
        }
    });
</script>